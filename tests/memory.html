<!doctype html>
<html>
  <head>
    <script src="../bower_components/jquery/dist/jquery.min.js"></script>
    <script src="../bower_components/jquery-ui/jquery-ui.min.js"></script>
    <script src="../bower_components/jsPsych/jspsych.js"></script>
    <script src="../bower_components/jsPsych/plugins/jspsych-text.js"></script>
    <script src="../bower_components/jsPsych/plugins/jspsych-single-stim.js"></script>
    <script src="../plugins/tutorial1.js"></script>
    <link rel="stylesheet" href="../bower_components/jquery-ui/themes/base/jquery-ui.min.css"/>
    <link rel="stylesheet" href="../bower_components/jsPsych/css/jspsych.css"/>
    <style>
      img { width: 300px; }
      .largeText {
          font-weight: bold;
        font-size: 400%;
      }
      .psych_window {
          color: white;
          background: black;
          vertical-align:middle;
          text-align: center;
          min-height: 500px;
          padding: 50px;
          margin:0 auto;
      }
    </style>
  </head>
  <body>
    <div class="center-content">
        <div id="jspsych-target" class="psych_window"></div>
    </div>
  </body>
  <script>
    /* define welcome message block */
    var welcome_block = {
      type: "text",
      text: "Next, you will do another kind of memory test. Pay close attention to the instructions." +
      "You will be shown a series of letters, one at a time in the middle of the screen." +
      " When each letter appears, you must decide if it is the same letter you saw exactly 2 letters before." +
      "<p>Press any key to begin.</p>"
    };
    var practice_block = {
        type: "text",
        text: "If the letter you are looking at is the SAME as the letter you saw" +
        " 2 letters before,  press the SPACEBAR. If it is not the same, do nothing." +
        " Here is an example of a sequence of letters you might see. To help you understand" +
        " we have shown them all in a row, but in the test, they will appear one at a time." +
        " In this example, you would press the spacebar when the letter A comes up," +
        "because it is the SAME letter that appeared 2 letters back. " +
        " You would not press the spacebar for the other letters; each one of them was different than" +
        "the letter that appeared 2 letters before it. Are you ready for some practice?"+
        "<p>Press any key to begin.</p>"
    };

    var post_trial_gap = function() {
      return Math.floor( Math.random() * 1500 ) + 750;
    }

/*    var test_block = {
      type: "single-stim",
      stimuli: all_trials.image,
      choices: ['F'],
      data: all_trials.data,
      timing_response: 1500,
      timing_post_trial: post_trial_gap
    };*/

    trialLetters = [];
trialLetters.push('<span class="largeText">j</span>');
trialLetters.push('<span class="largeText">u</span>');
trialLetters.push('<span class="largeText">b</span>');
trialLetters.push('<span class="largeText">u</span>');
trialLetters.push('<span class="largeText">i</span>');
trialLetters.push('<span class="largeText">s</span>');
trialLetters.push('<span class="largeText">i</span>');
trialLetters.push('<span class="largeText">a</span>');
trialLetters.push('<span class="largeText">s</span>');
trialLetters.push('<span class="largeText">a</span>');

    trialAnswers = [0,0,0,1,0,0,1,0,0,1];

    var test_block = {
    type: 'single-stim',
    stimuli: trialLetters,
    is_html: true,
    timing_response: 1500,
        choices: [' '], // space bar
    response_ends_trial: false
};

    /* define debrief block */

    function getAverageResponseTime() {
        var trials = jsPsych.data.getTrialsOfType('single-stim');
        var sum_rt = 0;
        var valid_trial_count = 0;
        for (var i = 0; i < trials.length; i++) {
            if (trials[i].response == ' ' && trials[i].rt > -1) {
                sum_rt += trials[i].rt;
                valid_trial_count++;
            }
        }
        return Math.floor(sum_rt / valid_trial_count);
    }
    function getCorrectAnswers() {
        var trials = jsPsych.data.getTrialsOfType('single-stim');
        var correct_rt = 0;
        var valid_trial_count = 0;
        for (var i = 0; i < trials.length; i++) {
            if (trials[i].response == ' ' && trials[i].rt > -1) {
                sum_rt += trials[i].rt;
                valid_trial_count++;
            }
        }
        return Math.floor(sum_rt / valid_trial_count);
    }

    var debrief_block = {
      type: "text",
      text: function() {
        return "<p>Your average response time was <strong>" +
        getAverageResponseTime() + "ms</strong>. Press " +
        "any key to complete the experiment. Thank you!</p>";
      }
    };

    /* create experiment definition array */
    var experiment = [];
    experiment.push(welcome_block);
    experiment.push(practice_block);
    experiment.push(test_block);
    experiment.push(debrief_block);

    /* start the experiment */
    jsPsych.init({
        display_element: $('#jspsych-target'),
      experiment_structure: experiment,
      on_finish: function() {
        jsPsych.data.displayData();
      }
    });
  </script>
</html>
